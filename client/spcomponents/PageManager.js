!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).SpPageManager=t()}(this,function(){"use strict";var e=function(e,t,s,a,i,r,l,o,n,d){"boolean"!=typeof l&&(n=o,o=l,l=!1);var c,p="function"==typeof s?s.options:s;if(e&&e.render&&(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),a&&(p._scopeId=a),r?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,n(e)),e&&e._registeredComponents&&e._registeredComponents.add(r)},p._ssrRegister=c):t&&(c=l?function(){t.call(this,d(this.$root.$options.shadowRoot))}:function(e){t.call(this,o(e))}),c)if(p.functional){var f=p.render;p.render=function(e,t){return c.call(t),f(e,t)}}else{var m=p.beforeCreate;p.beforeCreate=m?[].concat(m,c):[c]}return s};const t={props:["id","config"],data:function(){return{mode:0,editPage:null,pageSettings:{path:"",label:"",layout:"",roles:[],isTopLevel:!0,folder:null},pageErrors:{},editFolder:null,folderSettings:{label:"",roles:[]},folderErrors:{},pageForm:{fields:[{name:"path",label:"msg_path",type:"text",required:!0,customValidator:this.validatePath},{name:"label",label:"msg_label",type:"text",required:!0},{name:"layout",label:"msg_layout",type:"select",options:this.$app.adminData.pageLayouts.layoutList,required:!0},{name:"roles",label:"msg_access_roles",type:"select",multiple:!0,options:this.$app.constants.ROLES},{name:"isTopLevel",label:"msg_top_level",type:"checkbox"}]},folderForm:{fields:[{name:"label",label:"msg_label",type:"text",required:!0},{name:"roles",label:"msg_access_roles",type:"select",multiple:!0,options:this.$app.constants.ROLES}]}}},methods:{saveSiteDef:function(e){this.$app.rpc.invoke("SiteService","saveSiteDef",{siteDef:this.$app.site.siteDef},e,this.siteDefSaveError)},siteDefSaveError:function(){this.$app.modal.showErrorDialog("msg_failed_to_save_site_def")},validatePath:function(e,t){if(this.$app.getPage(t)){if(this.$app.getPage(t)!==this.editPage)return"error_duplicate_page_path"}else if(!/^[a-z0-9]+$/i.test(t))return"error_invalid_page_path";return null},cancelEdit:function(){this.mode=0},savePage:function(){this.editPage?this.$app.editPage(this.editPage.path,this.pageSettings,!0):this.$app.createPage(this.pageSettings,!0),this.editPage=null,this.pageSettings={path:"",label:"",layout:"",roles:[],isTopLevel:!0,folder:null},this.mode=0},saveFolder:function(){if(this.editFolder)this.editFolder.label=this.folderSettings.label,this.editFolder.roles=this.folderSettings.roles;else{var e={};e.roles=this.folderSettings.roles,e.pages=[],e.label=this.folderSettings.label,this.$app.site.siteDef.pages.push(e)}this.saveSiteDef(),this.editFolder=null,this.folderSettings={label:"",roles:[]},this.mode=0},setEditNode:function(e){e.pages?(this.editFolder=e,this.folderSettings=JSON.parse(JSON.stringify(e)),this.folderSettings.roles||(this.folderSettings.roles=[]),this.folderErrors={},this.mode=4):(this.editPage=e,this.pageSettings=JSON.parse(JSON.stringify(e)),this.pageSettings.roles||(this.pageSettings.roles=[]),this.pageErrors={},this.mode=3)},deleteNode:function(e){var t=e.parent,s=e.index,a=null,i=null;e.node.pages?(a=this.$i18n("msg_confirm_delete_named_entity",{entity:this.$i18n("msg_folder").toLowerCase(),name:this.$i18n(e.node.label)}),i=this.$i18n("msg_delete_entity",{entity:this.$i18n("msg_folder").toLowerCase()})):(a=this.$i18n("msg_confirm_delete_named_entity",{entity:this.$i18n("msg_page").toLowerCase(),name:this.$i18n(e.node.label)}),i=this.$i18n("msg_delete_entity",{entity:this.$i18n("msg_page").toLowerCase()})),this.$app.modal.showDialog(i,a,[i,"msg_cancel"],function(e){0==e&&(t.pages.splice(s,1),this.saveSiteDef())}.bind(this))}}};var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"sp-one-column-container"},[s("div",{staticClass:"card sp-card p-1 p-sm-4 mt-3"},[s("h4",{staticClass:"mb-4"},[e._v(e._s(e.$i18n("msg_page_manager")))]),e._v(" "),s("ul",{staticClass:"nav nav-pills mb-3"},[s("li",{staticClass:"nav-item"},[s("a",{staticClass:"nav-link",class:{active:0==e.mode},attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.mode=0}}},[e._v(e._s(e.$i18n("msg_home")))])]),e._v(" "),s("li",{staticClass:"nav-item"},[s("a",{staticClass:"nav-link",class:{active:1==e.mode},attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.mode=1}}},[e._v(e._s(e.$i18n("msg_new_page")))])]),e._v(" "),s("li",{staticClass:"nav-item"},[s("a",{staticClass:"nav-link",class:{active:2==e.mode},attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.mode=2}}},[e._v(e._s(e.$i18n("msg_new_folder")))])])]),e._v(" "),0==e.mode?s("sp-tree-editor",{attrs:{node:{pages:e.$root.site.siteDef.pages},"child-key":"pages","new-leaf-label":"msg_new_page","new-non-leaf-label":"msg_new_folder"},on:{"save-tree":e.saveSiteDef,"edit-node":e.setEditNode,"delete-node":e.deleteNode}}):1==e.mode?s("div",[s("sp-form",{attrs:{"form-def":e.pageForm,"data-object":e.pageSettings,errors:e.pageErrors,"form-id":"pageForm","save-label":"msg_create_page","save-callback":e.savePage,"cancel-callback":e.cancelEdit}})],1):2==e.mode?s("div",[s("sp-form",{attrs:{"form-def":e.folderForm,"data-object":e.folderSettings,errors:e.folderErrors,"form-id":"folderForm","save-label":"msg_save_folder","save-callback":e.saveFolder,"cancel-callback":e.cancelEdit}})],1):3==e.mode?s("div",[s("nav",{attrs:{"aria-label":"breadcrumb"}},[s("ol",{staticClass:"breadcrumb"},[s("li",{staticClass:"breadcrumb-item"},[s("a",{attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.mode=0}}},[e._v(e._s(e.$i18n("msg_home")))])]),e._v(" "),s("li",{staticClass:"breadcrumb-item active",attrs:{"aria-current":"page"}},[e._v(e._s(e.$i18n("msg_edit_page_metadata")))])])]),e._v(" "),s("sp-form",{attrs:{"form-def":e.pageForm,"data-object":e.pageSettings,errors:e.pageErrors,"form-id":"pageForm","save-label":"msg_save_metadata","save-callback":e.savePage,"cancel-callback":e.cancelEdit}})],1):4==e.mode?s("div",[s("nav",{attrs:{"aria-label":"breadcrumb"}},[s("ol",{staticClass:"breadcrumb"},[s("li",{staticClass:"breadcrumb-item"},[s("a",{attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.mode=0}}},[e._v(e._s(e.$i18n("msg_home")))])]),e._v(" "),s("li",{staticClass:"breadcrumb-item active",attrs:{"aria-current":"page"}},[e._v(e._s(e.$i18n("msg_edit_folder")))])])]),e._v(" "),s("sp-form",{attrs:{"form-def":e.folderForm,"data-object":e.folderSettings,errors:e.folderErrors,"form-id":"folderForm","save-label":"msg_save_folder","save-callback":e.saveFolder,"cancel-callback":e.cancelEdit}})],1):e._e()],1)])};s._withStripped=!0;return e({render:s,staticRenderFns:[]},void 0,t,void 0,!1,void 0,void 0,void 0)});

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).SpTreeEditor=t()}(this,function(){"use strict";var e,t=function(e,t,r,n,d,a,i,s,o,p){"boolean"!=typeof i&&(o=s,s=i,i=!1);var l,g="function"==typeof r?r.options:r;if(e&&e.render&&(g.render=e.render,g.staticRenderFns=e.staticRenderFns,g._compiled=!0,d&&(g.functional=!0)),n&&(g._scopeId=n),a?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,o(e)),e&&e._registeredComponents&&e._registeredComponents.add(a)},g._ssrRegister=l):t&&(l=i?function(){t.call(this,p(this.$root.$options.shadowRoot))}:function(e){t.call(this,s(e))}),l)if(g.functional){var h=g.render;g.render=function(e,t){return l.call(t),h(e,t)}}else{var c=g.beforeCreate;g.beforeCreate=c?[].concat(c,l):[l]}return r},r="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());var n={};var d=function(t){return function(t,d){return function(t,d){var a=r?d.media||"default":t,i=n[a]||(n[a]={ids:new Set,styles:[]});if(!i.ids.has(t)){i.ids.add(t);var s=d.source;if(d.map&&(s+="\n/*# sourceURL="+d.map.sources[0]+" */",s+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(d.map))))+" */"),i.element||(i.element=document.createElement("style"),i.element.type="text/css",d.media&&i.element.setAttribute("media",d.media),void 0===e&&(e=document.head||document.getElementsByTagName("head")[0]),e.appendChild(i.element)),"styleSheet"in i.element)i.styles.push(s),i.element.styleSheet.cssText=i.styles.filter(Boolean).join("\n");else{var o=i.ids.size-1,p=document.createTextNode(s),l=i.element.childNodes;l[o]&&i.element.removeChild(l[o]),l.length?i.element.insertBefore(p,l[o]):i.element.appendChild(p)}}}(t,d)}};const a={data:function(){return{dragged:null,dropped:null}},props:["node","childKey","parent","pos"],methods:{drop:function(e){this.parent||this.$emit("save-tree"),e.preventDefault()},dragStart:function(e){e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text","dummy"),this.parent?e.dragged||(e.dragged={target:this.node,parent:this.parent,pos:this.pos}):(this.dropped=null,this.dragged=e.dragged,e.stopPropagation())},dragOver:function(e){if(e.preventDefault(),this.parent){if(!e.dropped){if(this.node&&!e.target.getAttribute("handle")&&this.node[this.childKey])return void e.stopPropagation();e.dropped={target:this.node,parent:this.parent,pos:this.pos}}}else{if(!e.dropped)return;if(e.dropped.target===this.dragged.target)return;if(this.dragged.parent.label==e.dropped.parent.label&&this.dragged.pos==e.dropped.pos)return;if(this.dropped===e.dropped)return;if(this.dragged.target[this.childKey]&&this.node!==e.dropped.parent&&e.dropped.parent[this.childKey])return;this.dropped=e.dropped,this.dragged.parent[this.childKey].splice(this.dragged.pos,1);var t=this.dropped.pos;this.dropped.target?(this.dragged.parent===this.dropped.parent&&t>this.dragged.pos&&(t-=1),this.dropped.parent[this.childKey].splice(this.dropped.pos,0,this.dragged.target),this.dragged.pos=this.dropped.pos,this.dropped.pos=t):(this.dropped.parent[this.childKey].push(this.dragged.target),this.dragged.pos=this.dropped.parent[this.childKey].length-1),this.dragged.parent=this.dropped.parent,e.stopPropagation()}},dragEnd:function(e){e.stopPropagation(),e.preventDefault()},editNode:function(){this.$emit("edit-node",this.node)},deleteNode:function(){this.$emit("delete-node",{parent:this.parent,index:this.pos,node:this.node})},propagateEditNode:function(e){this.$emit("edit-node",e)},propagateDeleteNode:function(e){this.$emit("delete-node",e)}}};var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.node?e.node[e.childKey]?r("div",{staticClass:"card bg-light",class:{"m-2":e.parent},attrs:{node:e.node,draggable:!!e.parent},on:{dragend:e.dragEnd,dragstart:e.dragStart,dragover:e.dragOver,drop:e.drop}},[e.parent?r("div",{staticClass:"te-draggable px-3 py-2 d-flex align-items-center justify-content-between flex-row",attrs:{handle:"true"},on:{dragover:e.dragOver}},[r("span",[e._v(e._s(e.$i18n(e.node.label)))]),e._v(" "),r("span",{staticClass:"d-flex align-items-center"},[r("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.editNode(t)}}},[r("i",{staticClass:"material-icons md-12 text-dark"},[e._v("edit")])]),e._v(" "),r("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.deleteNode(t)}}},[r("i",{staticClass:"material-icons md-12 text-danger"},[e._v("delete")])])])]):e._e(),e._v(" "),r("div",{staticClass:"p-2"},[e._l(e.node[e.childKey],function(t,n){return r("sp-tree-editor",{key:t.id,attrs:{node:t,parent:e.node,pos:n,"child-key":e.childKey},on:{"edit-node":e.propagateEditNode,"delete-node":e.propagateDeleteNode}})}),e._v(" "),r("sp-tree-editor",{attrs:{parent:e.node,pos:-1,"child-key":e.childKey}})],2)]):r("div",{staticClass:"te-draggable card d-flex align-items-center justify-content-between flex-row px-3 py-2 m-2",attrs:{draggable:"true"},on:{dragstart:e.dragStart,dragover:e.dragOver,drop:e.drop,dragend:e.dragEnd}},[r("span",{staticClass:"d-block"},[r("router-link",{attrs:{to:e.node.path}},[e._v(e._s(e.$i18n(e.node.label)))])],1),e._v(" "),r("span",{staticClass:"d-flex align-items-center"},[r("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.editNode(t)}}},[r("i",{staticClass:"material-icons md-12 text-dark"},[e._v("edit")])]),e._v(" "),r("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.deleteNode(t)}}},[r("i",{staticClass:"material-icons md-12 text-danger"},[e._v("delete")])])])]):r("div",{staticClass:"sp-last-component border-light",on:{dragend:e.dragEnd,dragover:e.dragOver,drop:e.drop}})};i._withStripped=!0;return t({render:i,staticRenderFns:[]},function(e){e&&e("data-v-632f238e_0",{source:"\n.te-draggable {\n  cursor: move;\n}\n",map:{version:3,sources:["C:\\projects\\singlepage-js\\lib\\client\\dynamic_components\\util\\TreeEditor.vue"],names:[],mappings:";AASA;EACA,YAAA;AACA",file:"TreeEditor.vue",sourcesContent:['\x3c!--\r\n * Copyright 2019 Padmanabh Dabke. All Rights Reserved.\r\n *\r\n * Distributed under MIT license\r\n * https://opensource.org/licenses/MIT\r\n * \r\n --\x3e\r\n\r\n<style>\r\n  .te-draggable {\r\n    cursor: move;\r\n  }\r\n</style>\r\n<template>\r\n\x3c!-- childKey attribute specifies the children attribute --\x3e\r\n  <div v-if="!node" class="sp-last-component border-light"\r\n  @dragend="dragEnd" @dragover="dragOver" @drop="drop"></div>\r\n  <div v-else-if="node[childKey]" class="card bg-light" :class="{\'m-2\': parent}" :node="node" :draggable="parent ? true : false"\r\n    @dragend="dragEnd" @dragstart="dragStart" @dragover="dragOver" @drop="drop">\r\n    <div v-if="parent" class="te-draggable px-3 py-2 d-flex align-items-center justify-content-between flex-row" handle="true" @dragover="dragOver">\r\n      <span>{{$i18n(node.label)}}</span>\r\n      <span class="d-flex align-items-center">\r\n        <a href="#" @click.prevent="editNode"><i class="material-icons md-12 text-dark">edit</i></a>\r\n        <a href="#" @click.prevent="deleteNode"><i class="material-icons md-12 text-danger">delete</i></a>\r\n      </span>\r\n    </div>\r\n     <div class="p-2">\r\n      <sp-tree-editor v-for="(container, index) in node[childKey]" :key="container.id" :node="container"\r\n        :parent="node" :pos="index" :child-key="childKey" @edit-node="propagateEditNode" @delete-node="propagateDeleteNode"\r\n      >\r\n      </sp-tree-editor>\r\n      <sp-tree-editor :parent="node" :pos="-1" :child-key="childKey"></sp-tree-editor>\r\n      \x3c!-- <div class="sp-last-component" @dragover="dragOverLast" @drop="drop"></div> --\x3e\r\n    </div>\r\n  </div>\r\n  <div v-else class="te-draggable card d-flex align-items-center justify-content-between flex-row px-3 py-2 m-2" draggable="true"\r\n    @dragstart="dragStart" @dragover="dragOver" @drop="drop" @dragend="dragEnd">\r\n    <span class="d-block"><router-link :to="node.path">{{$i18n(node.label)}}</router-link></span>\r\n    <span class="d-flex align-items-center">\r\n      <a href="#" @click.prevent="editNode"><i class="material-icons md-12 text-dark">edit</i></a>\r\n      <a href="#" @click.prevent="deleteNode"><i class="material-icons md-12 text-danger">delete</i></a>\r\n    </span>\r\n  </div>\r\n</template>\r\n<script>\r\n"use strict";\r\nexport default {\r\n  data: function() {\r\n    return { dragged: null, dropped: null };\r\n  },\r\n  props: [\r\n    "node",\r\n    "childKey",\r\n    "parent",\r\n    "pos"\r\n  ],\r\n  methods: {\r\n    drop: function(e) {\r\n      if (!this.parent) {\r\n        this.$emit(\'save-tree\');\r\n      }\r\n      e.preventDefault();\r\n    },\r\n    dragStart: function(e) {\r\n      e.dataTransfer.effectAllowed = "move";\r\n      // Firefox doesn\'t seem to allow dragging unless you invoke e.dataTransfer.SetData\r\n      e.dataTransfer.setData("text", "dummy");\r\n      if (!this.parent) {\r\n        // This is the root node\r\n        this.dropped = null;\r\n        this.dragged = e.dragged;\r\n        e.stopPropagation();\r\n      } else if (!e.dragged) {\r\n        e.dragged = { target: this.node, parent: this.parent, pos: this.pos };\r\n      }\r\n\r\n    },\r\n\r\n    dragOver: function(e) {\r\n      e.preventDefault();\r\n      if (!this.parent) {\r\n        // This is the root node\r\n        if (!e.dropped) return;\r\n        if (e.dropped.target === this.dragged.target) return;\r\n        if (\r\n          this.dragged.parent.label == e.dropped.parent.label &&\r\n          this.dragged.pos == e.dropped.pos\r\n        )\r\n          return;\r\n        if (this.dropped === e.dropped) return;\r\n\r\n        // For now we don\'t allow recursive folder structure, this may change in future\r\n        if (this.dragged.target[this.childKey] && this.node !== e.dropped.parent && e.dropped.parent[this.childKey]) return;\r\n\r\n        this.dropped = e.dropped;\r\n\r\n        // Remove dragged element\r\n        this.dragged.parent[this.childKey].splice(this.dragged.pos, 1);\r\n\r\n        var addPos = this.dropped.pos;\r\n        if (!this.dropped.target) {\r\n          this.dropped.parent[this.childKey].push(this.dragged.target);\r\n          this.dragged.pos = this.dropped.parent[this.childKey].length - 1;\r\n        } else {\r\n          // The position of the drop element changes when we remove the dragged element when they both\r\n          // belong to the same parent and the dragged position is less than the dropped position\r\n          if (\r\n            this.dragged.parent === this.dropped.parent &&\r\n            addPos > this.dragged.pos\r\n          ) {\r\n            addPos = addPos - 1;\r\n          }\r\n          this.dropped.parent[this.childKey].splice(\r\n            this.dropped.pos,\r\n            0,\r\n            this.dragged.target\r\n          );\r\n          this.dragged.pos = this.dropped.pos;\r\n          this.dropped.pos = addPos;\r\n       }\r\n        this.dragged.parent = this.dropped.parent;\r\n        e.stopPropagation();\r\n      } else if (!e.dropped) {\r\n        // This check ensures that drop on a folder is recognized only when the element is\r\n        // over the folder header, otherwise it creates inconsistent behavior when the drop\r\n        // is in between two leaves in a folder\r\n        if (this.node && !e.target.getAttribute("handle") && this.node[this.childKey]) {\r\n          e.stopPropagation();\r\n          return;\r\n        }\r\n        e.dropped = { target: this.node, parent: this.parent, pos: this.pos };\r\n      }\r\n    },\r\n\r\n    dragEnd: function(e) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n      \r\n    },\r\n\r\n    editNode: function(/* ev */) {\r\n      this.$emit("edit-node", this.node);\r\n    },\r\n\r\n    deleteNode: function(/* ev */) {\r\n      this.$emit("delete-node", {parent: this.parent, index: this.pos, node: this.node});\r\n    },\r\n\r\n    propagateEditNode: function(n) {\r\n      this.$emit(\'edit-node\', n);\r\n    },\r\n\r\n    propagateDeleteNode: function(n) {\r\n      this.$emit(\'delete-node\', n);\r\n    }\r\n  }\r\n};\r\n<\/script>']},media:void 0})},a,void 0,!1,void 0,d,void 0)});
